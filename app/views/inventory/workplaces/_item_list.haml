.row
  .col-xlg-24
    %h4 Состав рабочего места

.row.ng-hide{ "ng-show": "wp.workplace.workplace_type" }
  .col-xlg-24
    %p.bg-info.context-info{ "ng-bind": "wp.workplace.workplace_type.full_description" }

.row#wp_item_list
  .col-xlg-24
    %uib-tabset{ active: "active" }
      %uib-tab{ "ng-repeat": "item in wp.workplace.inv_items_attributes", heading: "{{item.type.short_description}}",
      index: "$index" }
        .ng-hide{ "ng-show": "item" }
          .col-lg-offset-3.col-xlg-offset-4.col-fhd-offset-5.col-md-24.col-lg-18.col-xlg-16.col-fhd-14
            -# Постоянные параметры.
            .col-md-8.col-lg-8.col-xlg-8
              .form-group
                = label_tag :workplace_items__invent_num, "Инвентарный номер", class: "control-label"
            .col-md-16.col-lg-16.col-xlg-16
              .form-group
                %div{ "ng-if": "wp.additional.pcTypes | contains:item.type.name" }
                  .input-group
                    = text_field_tag "workplace[items][][invent_num]", "", class: "form-control", "ng-model": |
                    "item.invent_num", "ng-blur": "wp.checkPcInvnum(item)" |
                    .input-group-btn
                      = button_tag type: :button, class: "btn-default", "data-toggle": "dropdown", "ng-disabled": |
                      "wp.additional.auditData" do |
                        Данные
                        %span.caret
                      %ul.dropdown-menu.dropdown-menu-right
                        %li= link_to "Получить автоматически", "", "ng-click": "wp.getAuditData(item)",
                        "disable-link": true
                        %li= link_to "Внести вручную", "", "ng-click": "wp.runManuallyPcDialog(item)",
                        "disable-link": true
                      = button_tag type: :button, class: "btn-danger", "ng-click": "wp.changeAuditData(item)", |
                      "ng-disabled": "!wp.additional.auditData" do |
                        = fa_icon "ban lg"

                %div{ "ng-if": "!(wp.additional.pcTypes | contains:item.type.name)" }
                  = text_field_tag "workplace[items][][invent_num]", "", class: "form-control", "ng-model": |
                  "item.invent_num", "ng-blur": "wp.checkPcInvnum(item)" |

            .col-md-8.col-lg-8.col-xlg-8
              .form-group
                = label_tag :workplace_items__item_model, "Модель", class: "control-label"
            .col-md-16.col-lg-16.col-xlg-16
              .form-group
                -# Если модель необходимо ввести вручную (так как нет вариантов для данного аида техники).
                %div{ "ng-if": "!item.type.inv_models.length" }
                  = text_field_tag "workplace[items][][item_model]", "", class: "form-control", "ng-model": |
                  "item.item_model" |

                -# Если модель необходимо выбрать или ввести вручную, так как варианты из списка не подходят.
                %div{ "ng-if": "item.type.inv_models.length" }
                  = select_tag "workplace[items][][model_id]", "", class: "form-control", "ng-change": |
                  "wp.changeItemModel(item)", "ng-model": "item.model", "ng-options": |
                  "model as model.item_model disable when model.model_id == -1 for model in |
                  item.type.inv_models track by model.model_id" |

                  %div{ "ng-if": "!item.model_id" }
                    %label Введите наименование модели
                    = text_field_tag "workplace[items][][item_model]", "", class: "form-control", "ng-model": |
                    "item.item_model" |

            -# Переменные параметры.
            %div{ "ng-repeat": "prop in item.type.inv_properties track by $index", "ng-if": "item.model_id != -1 || |
            item.type.inv_models.length == 0", "ng-hide": "prop._destroy || prop.name == 'config_file'" } |
              .col-md-8.col-lg-8.col-xlg-8
                .form-group
                  %label{ "ng-bind": "prop.short_description" }
              .col-md-16.col-lg-16.col-xlg-16
                .form-group
                  %div{ "ng-switch": true, "on": "prop.property_type" }
                    %div{ "ng-switch-when": "string" }
                      = text_field_tag "", "", class: "form-control", "ng-disabled": "wp.additional.pcTypes | |
                      contains:item.type.name", "ng-model": "item.inv_property_values_attributes[$index].value" |
                      -#"ng-value": "item.inv_property_values_attributes[$index].value"

                    %div{ "ng-switch-when": "list" }
                      = select_tag "", "", class: "form-control", "ng-disabled": |
                      "item.inv_property_values_attributes[$index].filteredList.length == 1", "ng-model": |
                      "item.inv_property_values_attributes[$index].property_list_id", "ng-options": |
                      "prop_list.property_list_id as prop_list.short_description disable when |
                      prop_list.property_list_id == -1 for prop_list in |
                      item.inv_property_values_attributes[$index].filteredList" |

                    %div{ "ng-switch-when": "list_plus" }
                      = select_tag "", "", class: "form-control", "ng-disabled": |
                      "item.inv_property_values_attributes[$index].filteredList.length == 1", "ng-model": |
                      "item.inv_property_values_attributes[$index].property_list_id", "ng-options": |
                      "prop_list.property_list_id as prop_list.short_description disable when |
                      prop_list.property_list_id == -1 for prop_list in |
                      item.inv_property_values_attributes[$index].filteredList" |

                      %div{ "ng-if": "!item.model_id && !item.inv_property_values_attributes[$index].property_list_id" }
                        %label Введите {{prop.short_description}}
                        = text_field_tag "workplace[items][][property_values][value]", "", class: "form-control", "ng-model": |
                        "item.inv_property_values_attributes[$index].value", "ng-value": |
                        "item.inv_property_values_attributes[$index].value" |
